<div class="container d-flex justify-content-between">
  <div class="row mb-3">
    <%= link_to 'Modificar', edit_vrental_statement_path(@vrental, @statement), class: "btn btn-secondary" %> <%= link_to 'Esborrar', @statement, class: "btn btn-danger", data: {turbo_method: :delete, turbo_confirm: "Segur que vols esborrar la liquidació de #{@vrental.name}?"} %>
  </div>
  <div data-controller="spinner" >
    <%= link_to 'Liquidació en PDF', vrental_statement_path(@vrental, @statement, format: :pdf), class: "btn btn-primary", data: { "spinner-target" => "printbutton", "action" => "click->spinner#spin"}  %>
  </div>
</div>
<div class="container">
  <div class="container border">
    <div class="row mb-2">
      <div class="col-12">
        <span class="font-weight-bold">LIQUIDACI&Oacute; LLOGUER</span><br>
        <span><%= @statement.location %>, <%= I18n.l(@statement.date) %></span>
      </div>
    </div>
    <div class="row mb-2 border">
      <div class="col-6 font-weight-bold">PROPIETARI</div>
      <div class="col-6 text-right font-weight-bold">IMMOBLE</div>
    </div>
    <div class="row mb-2">
      <div class="col-6">
        <ul class="list-unstyled p-0">
          <li class="fw-bold"><%= @vrental.vrowner.fullname %></li>
          <li class="fw-bold"><%= @vrental.vrowner.document %></li>
          <li><%= @vrental.vrowner.address %></li>
          <li><%= @vrental.vrowner.email %></li>
          <li><%= @vrental.vrowner.phone %></li>
        </ul>
      </div>
      <div class="text-right col-6">
        <ul class="list-unstyled p-0">
          <li class="fw-bold"><%= @vrental.name %></li>
          <li class="fw-bold"><%= @vrental.licence %></li>
          <li><%= @vrental.address %></li>
          <li><%= @vrental.cadastre %></li>
        </ul>
      </div>
    </div>
  </div>
  <div class="container border mt-3">
    <div class="row border-bottom">
      <div class="col-10 border-right font-weight-bold">INGRESSOS</div>
      <div class="col-2 text-right font-weight-bold">IMPORT</div>
    </div>
    <% @statement_earnings.each do |earning| %>
      <div class="row border-bottom">
        <div class="col-10 border-right">
          Reserva <%= earning.booking.firstname.titleize %> <%= earning.booking.lastname.titleize %> (<%= I18n.l(earning.booking.checkin, format: :standard) %> - <%= I18n.l(earning.booking.checkout, format: :standard) %>)
          <br>
          <% if earning.discount && earning.discount != 0 && earning.discount < 1 %>
            <small class="fst-italic">Descompte: <%= number_to_percentage(earning.discount * 100, precision: 2, separator: ',') %>
              <%= "(#{earning.description})" if earning.description.present? %></small>
          <% end %>
        </div>
        <div class="text-right col-2">
          <%= number_to_currency(earning.amount, unit: "€", separator: ",", delimiter: ".", precision: 2) %>
        </div>
      </div>
    <% end %>
    <div class="row">
      <div class="col-10 font-weight-bold border-right">Total</div>
      <div class="col-2 text-right font-weight-bold"><%= number_to_currency(@total_statement_earnings, unit: "€", separator: ",", delimiter: ".", precision: 2) %></div>
    </div>
  </div>
  <div class="container border mt-3">
    <div class="row border-bottom">
      <div class="col-10 border-right font-weight-bold">HONORARIS</div>
      <div class="col-2 text-right font-weight-bold">IMPORT</div>
    </div>
    <div class="row border-bottom">
      <div class="col-10 border-right">Honoraris agència <%= number_to_percentage(@vrental.commission * 100, precision: 0) %></div>
      <div class="col-2 text-right">-<%= number_to_currency(@agency_commission, unit: "€", separator: ",", delimiter: ".", precision: 2) %></div>
    </div>
    <div class="row border-bottom">
      <div class="col-10 border-right">IVA honoraris agència 21 %</div>
      <div class="col-2 text-right">-<%= number_to_currency(@agency_commission_vat, unit: "€", separator: ",", delimiter: ".", precision: 2) %></div>
    </div>
    <div class="row">
      <div class="col-10 border-right font-weight-bold">Total</div>
      <div class="col-2 text-right font-weight-bold">-<%= number_to_currency(@agency_commission + @agency_commission_vat, unit: "€", separator: ",", delimiter: ".", precision: 2) %></div>
    </div>
  </div>
  <% if @statement.expenses.present? %>
    <div class="container border mt-3">
      <div class="row border-bottom">
        <div class="col-10 border-right font-weight-bold">DESPESES</div>
        <div class="col-2 text-right font-weight-bold">IMPORT</div>
      </div>
      <% @statement_expenses.each do |expense| %>
        <div class="row border-bottom">
          <div class="col-10 border-right"><%= expense.description %></div>
          <div class="col-2 text-right">-<%= number_to_currency(expense.amount, unit: "€", separator: ",", delimiter: ".", precision: 2) %></div>
        </div>
      <% end %>
      <div class="row">
        <div class="col-10 border-right font-weight-bold">Total</div>
        <div class="col-2 text-right font-weight-bold">-<%= number_to_currency(@statement_expenses.pluck(:amount).sum, unit: "€", separator: ",", delimiter: ".", precision: 2) %></div>
      </div>
    </div>
  <% end %>
  <div class="container border mt-3">
    <div class="row">
      <div class="col-10 border-right font-weight-bold">TOTAL</div>
      <div class="col-2 text-right font-weight-bold"><%= number_to_currency((@total_statement_earnings - @agency_commission - @agency_commission_vat), unit: "€", separator: ",", delimiter: ".", precision: 2) %></div>
    </div>
  </div>
  <div class="container mt-5">
    <div class="row">
      <div class="col-12 text-center">
        <span class="font-weight-bold">Sistach Rentals &middot; Inverstach, S.L. &middot; CIF N&ordm;: B66577537</span><br>
        <span>Avinguda Grècia 39, baixos, 17528 L&rsquo;Estartit (Girona)</span>
        <br>
        <span>c/Roser 1, 1-2, 08600 Berga (Barcelona)</span>
        <br>
        www.sistachrentals.com &nbsp;Tel: +34 972 100 381 &middot; +34 609 076 292 &middot; info@sistachrentals.com</span>
    </div>
  </div>
</div>
</div>
