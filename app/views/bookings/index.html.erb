<h1>Reserves</h1>
<table class="table table-hover">
  <thead>
    <tr>
      <th scope="col">Portal</th>
      <th scope="col">Client</th>
      <th scope="col">Check-in</th>
      <th scope="col">Check-out</th>
      <th scope="col">Preu</th>
      <th scope="col">Lloguer</th>
      <th scope="col">Neteja</th>
      <th scope="col">Taxa tur.</th>
      <th scope="col">Altres</th>
      <th scope="col">Comissió</th>
    </tr>
  </thead>
  <tbody>
    <% @bookings.each do |booking| %>
      <tr>
        <th scope="row"><%= booking.referrer %></th>
        <% if booking.tourist %>
          <td><%= booking.tourist.firstname + ' ' + booking.tourist.lastname %></td>
        <% else %>
          <td><%= booking.firstname + ' ' + booking.lastname %></td>
        <% end %>
        <td><%= I18n.l(booking.checkin) %></td>
        <td><%= I18n.l(booking.checkout) %></td>
        <td><%= number_to_currency(booking.price, unit: "€", separator: ",", delimiter: ".", precision: 2) %></td>
        <td><%= number_to_currency(booking.charges.where(charge_type: 'rent')&.sum(:price), unit: "€", separator: ",", delimiter: ".", precision: 2) %></td>
        <td><%= number_to_currency(booking.charges.where(charge_type: 'cleaning')&.sum(:price), unit: "€", separator: ",", delimiter: ".", precision: 2) %></td>
        <td><%= number_to_currency(booking.charges.where(charge_type: 'city_tax')&.sum(:price), unit: "€", separator: ",", delimiter: ".", precision: 2) %></td>
        <td><%= number_to_currency(booking.charges.where(charge_type: 'other')&.sum(:price), unit: "€", separator: ",", delimiter: ".", precision: 2) %></td>
        <td><%= number_to_currency(booking.commission, unit: "€", separator: ",", delimiter: ".", precision: 2) %></td>
      </tr>
    <% end %>
  </tbody>
</table>
<% if @vrental %>
  <% if @rates.where("DATE_PART('year', firstnight) = ?", Date.today.year).exists? %>
    <%= link_to "Importar reserves de beds", get_bookings_vrental_path(@vrental), class: "btn btn-secondary"%>
  <% else %>
    <span>Abans de importar reserves, has de importar tarifes d'aquest any</span>
    <%= link_to "Ves a Tarifes", get_bookings_vrental_path(@vrental), class: "btn btn-secondary"%>
  <% end %>
<% end %>
